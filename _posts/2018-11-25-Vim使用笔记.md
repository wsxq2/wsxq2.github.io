---
tags: [Vim, Neovim, LSP, IDE]
last_modified_time: 2025-03-30 23:05:39 +0800
---

# Vim 使用笔记

## 概述

[Vim] 是一个非常强大的文本编辑器，最初是 vi 编辑器的改进版。Vim 是 Vi IMproved 的缩写。Vim 支持多种编程语言和文件格式，并且可以在几乎所有的操作系统上运行。Linux 下有两大主流的文本编辑器，一个是 Emacs，另一个就是 Vim。Vim 以其强大的功能和灵活的配置选项而闻名，深受程序员和系统管理员的喜爱。

随着时间的推移，出现了 [Neovim]，Neovim 是 Vim 的一个分支，旨在提供更好的可扩展性和用户体验。Neovim 继承了 Vim 的许多功能，并在此基础上进行改进。Neovim 也常常简称为 nvim

本文将对 vim 的使用进行一些基本的介绍和配置说明。Vim 的学习曲线相对较陡，但一旦掌握，便能极大地提高文本编辑效率。neovim 新增的功能和改进使其成为一个更现代化的编辑器，但基本的操作和命令与 Vim 保持一致。因此，本文中的许多内容同样适用于 neovim。

推荐使用 neovim。

## 获取帮助

vim 非常注重用户体验，内置了丰富的帮助系统，建议使用`:help help.txt`（注意其中的冒号是必需的，用于进入命令行模式，后面会具体说明模式这个概念）命令通读下在 vim 中获取帮助。下面是我的个人理解，仅供参考。

vim 内置的帮助文档主要包括两个部分：用户手册和参考手册。用户手册主要面向普通用户，提供了 Vim 的基本使用方法和常见问题的解答；参考手册则更为详尽，涵盖了 Vim 的所有命令、选项和功能。用户手册可通过`:h usr_toc`命令查看

要获取帮助，只需在 Vim 中输入`:help`，然后跟上你想了解的主题或命令，这里的`help`也可以简写为`h`。你甚至可以使用`:help help`命令获取`:help`命令的帮助。下面是一些例子：

* `h gd`: 输入`h gd`可查看普通模式下`gd`命令的帮助
* `h :h`: 输入`h :h`可查看命令模式下`h`命令的帮助
* `h i_CTRL_N`: 输入`h i_CTRL_N`可查看插入模式下`Ctrl+N`的帮助
* `h 'nu`: 输入`h 'nu`可查看选项`nu`的帮助（选项通过命令模式下的`set`命令来设置，如`set nu`）

此外，vim 专门为新用户提供了一个入门指南，可以通过`:help tutor`命令来了解如何使用。这个教程非常适合初学者，可以帮助你快速上手 Vim 的基本操作。

## 配置文件 

vim 主要配置文件为`~/.vimrc`，该文件格式为 `vimscript`，它会在每次启动`vim`时执行，通过修改它我们可以修改 vim 的行为。`vimscript`中的命令是处于命令行模式下的命令。

需要注意的是，nvim 的配置文件为`init.vim`或`init.lua`（二者选其一），它是 neovim 的主要配置文件。与 Vim 的 `~/.vimrc` 类似，`init.vim` 也是使用 `vimscript` 语言编写的。其所在路径根据操作系统的不同而有所不同，详见`:h init.vim`。推荐使用`init.lua`，因为 Lua 语言比 vimscript 更加现代化和高效，且易于学习和使用。

`vim`的配置文件并非只能是一个，它可以在其中包含多个文件，这样可以帮助我们更好地组织配置。例如，我们可以在`~/.vimrc`中使用如下命令来包含其他配置文件：

```vim
source xxx.vim
```

关于 vimscript 的使用可以参考`:h vimscript`，也可参考《Learn Vimscript The Hard Way》。

如果使用 nvim，且使用配置文件`init.lua`，则可以使用如下命令包含其他文件：

```lua
require('xxx.lua')
```

关于 nvim 中 lua 语言的使用教程可参考`:h lua`。

## 模式

vim 有七种基本模式和六种额外模式，详见 `:h vim-modes`。这里只说明下四种常用模式：普通模式（Normal Mode）、插入模式（Insert Mode）、命令行模式（Command-line Mode）、可视模式(Visual Mode)：

* 普通模式：用得最多的模式，在该模式下，可以使用单字母命令进行移动光标、编辑文本等操作。在任意模式中按`Esc`或`Ctrl+[`（可能需要多次）进入普通模式
* 插入模式：输入文本的模式，在该模式下，才能正常像记事本那样输入文本。在普通模式中使用插入相关的命令（如`i`）进入插入模式
* 命令行模式：执行命令的模式，在该模式下，可以执行各种命令，vim 配置文件中通常也执行这种模式下的命令。在普通模式中按`:`进入命令行模式
* 可视模式：选择文本模式，进入此模式后，可以移动光标，在此期间相应的文本会处于选中状态。在普通模式中按`v`或`V`（行选择）或`Ctrl+V`（列选择）进入选择模式

各种模式切换详见`:h mode-switching`

下面简单说明下各个模式下的常用命令（个人习惯使用的命令，可能和其他人的习惯不一样）。

### 普通模式

普通模式下的常用命令如下：

* `i` `a` `I` `A`: 均用于进入插入模式。`i`(insert)在当前字符前插入，`a`(append)在当前字符后插入，`I`在当前行的第一个字符前插入，`A`在当前行的最后一个字符后插入
 
* `j` `k`: `j`用于移动到下一行，`k`用于移动到上一行
 
* `h` `l`：移动命令。`h`向左移动一个字符；`l`向右移动一个字符
* `0` `^` `$`: 移动命令。`0`移动到行首；`^`和`0`类似，只是移动到行首的第一个非空白字符；`$`移动到行尾
* `w` `e` `b` `W` `E` `B`: 移动命令。`w`右移一个单词；`e`和`w`类似，只是停在末尾处；`b`左移一个单词；`W`移动到下一个空格后的第一个字符；`E`和`W`类似，只是停在末尾处；`B`移动到上一个空格后的第一个字符
* `f` `F` `t` `T` `,` `;`: 移动命令。`f`向后移动至某个字符，如`fa`向后移动至`a`字符；`F`向前移动至某个字符；`t`向后移动至某个字符的前一个字符；`T`向前移动至某个字符的后一个字符；`,`重复上一个和前述命令相同的移动命令；`;`和`,`类似，不过方向相反
* `c`(Change): 改变文本并进入插入模式。该命令合移动命令使用，如`cw`改变一个单词，`cb`反向改变一个单词，`cl`改变一个字符等等 
* `cc`: 改变当前行的所有内容，相当于`0c$`
* `C`: 改变当前光标所在位置至行尾的内容，相当于`c$`
* `s`(Substitute): `cl`的简写，用于修改一个字符
* `r`(Replace): 和`s`类似，只是不会进入插入模式
* `d`(Delete): 删除文本。该命令同样配合移动命令使用
* `dd`: 删除当前行的所有内容，相当于`0d$`
* `D`: 删除当前光标所在位置至行尾的内容，相当于`d$`
* `x`: `dl`的简写，用于删除一个字符
* `p` `P`: 粘贴命令。`p`(paste)在当前字符后粘贴，`P`在当前字符前粘贴。**注意，该命令亦会粘贴已经删除的内容**
* `y`(yank): 复制命令。和移动命令配合使用，如`yl`复制一个字符，`yw`复制一个单词
* `yy`: 复制整行内容。相当于`0y$`
* `v`: 用于选择，以进入 Visual 模式
* `*` `#`: 搜索命令。`*`搜索当前单词并跳转到下一处；`#`搜索当前单词并跳转到上一处
* `K`: 查询当前单词的帮助。默认查询`man`手册（也可以先选择后再查询，即`vWK`）。详见 vim 内置帮助文档`:h :Man` 
* `gg` `G`: 跳转命令。`gg`跳至整个文件的第一行；`G`跳到整个文件的最后一行
* `50%` `%`: 跳转命令。`50%`跳到文件的50%处（即一半的地方，同理，`25%`则跳到 1/4 处）；`%`（即前面不加数字）则完全不同，它用于跳转到当前括号的匹配括号处（如当前是`(`，则跳到`)`）
* `gd` `gD` `gf`: 跳转命令。`gd`跳到当前光标所指局部变量的定义位置；`gD`跳到当前光标所指全局变量的定义位置；`gf`跳到当前光标所指路径的文件
* `qa一堆操作q` `@a`: `q`是宏录制命令，`qa`表示将宏录制到寄存器`a`，宏是操作的集合，可以是任意的 Vim 命令或操作。当你完成录制后，按`q`结束录制。要执行这个宏，只需使用`@a`命令即可执行寄存器`a`中的宏操作
* `@:`: 执行上一个命令行模式命令。这个命令非常有用，可以重复执行上一次的命令，而不需要重新输入
* `ma` `'a`: 设置书签。`ma`将当前光标位置标记为`a`，可以使用`'a`跳转到标记`a`的位置。这样可以快速跳转到文件中的特定位置，非常实用
* `.`: 重复上一次的修改命令。这个命令非常强大，可以重复执行上一次的编辑操作，非常适合需要多次执行相同操作的场景。
* `u` `Ctrl+r`: 撤销和重做命令。`u`用于撤销上一次的操作，类似 Windows 下的`Ctrl+Z`可以连续撤销多次；`Ctrl+r`用于重做撤销的操作，类似 Windows 下的`Ctrl+Y`。如果你不小心删除了某些内容，使用`u`可以轻松恢复，非常实用
* `=`: 格式化命令。用于格式化选定的文本，使其符合当前的缩进规则。可以在 Visual 模式下选择文本后使用`=`进行格式化，非常适合需要调整代码缩进的场景
* `>>` `<<`: 缩进命令。`>>`用于将当前行或选定的文本向右缩进，`<<`用于将当前行或选定的文本向左缩进。这两个命令非常适合需要调整代码缩进的场景，可以帮助你快速整理代码格式
* `Ctrl+c`: 取消当前操作并返回到普通模式。这个命令类似于`Esc`，但有时在某些情况下可能更有效，尤其是在处理一些复杂的操作时
* `1<C-g>`：`1<C-g>`显示当前文件路径。

### 插入模式

* `Ctrl+P`: 上一个补全建议。这个命令可以帮助你在插入模式下快速找到之前输入过的内容，非常适合需要频繁输入相似内容的场景
* `Ctrl+N`: 下一个补全建议。这个命令与`Ctrl+P`相反，用于在插入模式下查找下一个补全建议，非常适合需要频繁输入相似内容的场景
* `Ctrl+X Ctrl+L`: 补全行。
* `Ctrl+X Ctrl+F`: 补全文件名及路径。这个命令可以帮助你在插入模式下快速补全文件名，非常适合需要频繁输入文件路径的场景
* `<C-r>"`: 输入寄存器内容。在插入模式下，使用`<C-r>"`可以将寄存器中的内容插入到当前光标位置，非常适合需要频繁使用寄存器内容的场景
* `Ctrl+W`: 向前清除一个单词
* `Ctrl+U`: 向前清除到行首

### 命令行模式

* `Ctrl+D`: 显示所有可能的结果
* `Tab`: 按可能的结果依次补全
* `h xxx<CR>`: 查看`xxx`的帮助。如下述例子：
  * `h gd`: 输入`h gd`可查看普通模式下`gd`命令的帮助
  * `h :h`: 输入`h :h`可查看命令模式下`h`命令的帮助
  * `h i_CTRL_N`: 输入`h i_CTRL_N`可查看插入模式下`Ctrl+N`的帮助
  * `h 'nu`: 输入`h 'nu`可查看选项`nu`的帮助（选项通过命令模式下的`set`命令来设置，如`set nu`）

### 可视模式

许多在普通模式下可用的命令在可视模式下也可用，但有些命令在可视模式下会有所不同，具体可自行尝试或参见 `:h visual-mode`。

## LSP

[LSP](https://microsoft.github.io/language-server-protocol/) 即 Language Server Protocol（语言服务器协议），它是一种用于编辑器和 IDE 的通信协议，旨在提供语言智能感知功能，如代码补全、错误检查、跳转定义等。通过 LSP，编辑器可以与不同的语言服务器进行通信，从而支持多种编程语言的智能感知功能。

简单来说，LSP 实现了“一个编辑器支持多种编程语言的开发”，而不需要编辑器本身内置对每种语言的支持。这样，编辑器只需实现 LSP 客户端，而语言服务器可以独立于编辑器开发和维护。

语言服务器列表可参见 [Language Servers](https://microsoft.github.io/language-server-protocol/implementors/servers/)，支持 LSP 的工具/IDE 可参见 [Tools supporting the LSP](https://microsoft.github.io/language-server-protocol/implementors/tools/)

vim 原生不支持 LSP，nvim 从 0.5 开始原生支持 LSP。对于 nvim 而言，LSP 相关最重要的插件莫过于 [neovim/nvim-lspconfig](https://github.com/neovim/nvim-lspconfig)

## 发行版

vim 的“发行版”是指一组预配置的 Vim 设置、插件和主题，旨在提供开箱即用的编辑体验。这些发行版通常会预先配置许多插件和功能，使用户可以立即开始使用，而无需手动配置每个细节。对于新用户来说，这些发行版可以大大简化 Vim 的入门过程（但个人并不推荐新用户使用，因为遇到问题常常无从下手）。

vim 有很多发行版：

* [liuchengxu/space-vim: Lean & mean spacemacs-ish Vim distribution](https://github.com/liuchengxu/space-vim)
* [amix/vimrc: The ultimate Vim configuration (vimrc)](https://github.com/amix/vimrc)
* ...

nvim 有更多：

* [nvim-lua/kickstart.nvim: A launch point for your personal nvim configuration](https://github.com/nvim-lua/kickstart.nvim)：严格来讲，这不是一个发行版，而是一个模板，可以用来快速构建自己的配置。
* [NvChad/NvChad: Blazing fast Neovim framework providing solid defaults and a beautiful UI, enhancing your neovim experience.](https://github.com/NvChad/NvChad)
* [LazyVim/LazyVim: Neovim config for the lazy](https://github.com/LazyVim/LazyVim)
* [LunarVim/LunarVim: 🌙 LunarVim is an IDE layer for Neovim. Completely free and community driven.](https://github.com/LunarVim/LunarVim)
* [AstroNvim/AstroNvim: AstroNvim is an aesthetic and feature-rich neovim config that is extensible and easy to use with a great set of plugins](https://github.com/AstroNvim/AstroNvim)
* ...

需要注意的是，不要沉迷于比较哪个发行版更好，因为每个发行版都有其独特的配置和插件选择，适合不同的用户需求和偏好。最重要的是找到适合自己的配置，并根据自己的需求进行调整和优化。如果你在使用过程中发现无法解决遇到的问题，那么我建议从头开始，如从一些教程或者我前面提到的官方 help 开始，也可参考前面提到的 kickstart.nvim

我当前使用的发行版是 LazyVim，相关的折腾可参见我的另一篇文章 [使用 nvim 打造多平台通用的 IDE](https://wsxq2.55555.io/blog/2025/03/29/%E4%BD%BF%E7%94%A8NVIM%E6%89%93%E9%80%A0%E5%A4%9A%E5%B9%B3%E5%8F%B0%E9%80%9A%E7%94%A8%E7%9A%84IDE/)，在那篇笔记中，我记录了从安装、配置到使用的一些经验和教训。

## 遇到过的问题

### 编码问题？

详情参见 [VIM 文件编码识别与乱码处理](http://edyfox.codecarver.org/html/vim_fileencodings_detection.html)
在 Vim 中，有四个与编码有关的选项，它们是：`fileencodings`、`fileencoding`、`encoding` 和 `termencoding`。在实际使用中，任何一个选项出现错误，都会导致出现乱码：
* `encoding`: VIM 内部字符编码
  
  建议设置：
  ```vim
  set encoding=utf-8 "这通常是 VIM 的默认值
  ```
  
* `termencoding`: VIM 用于屏幕显示的编码
  
  建议设置：
  ```vim
  set termencoding=utf-8 "for Linux
  set termencoding=gbk/cp936 "for Windows
  ```

* `fileencoding`: VIM 探测到的文件的编码

  建议设置：
  ```vim
  set fileencoding? "通常不建议设置该选项，除非你确定你知道文件本身正确的编码
  ```

* `fileencodings`: VIM 自动识别编码的顺序

  建议设置：
  ```vim
  set fileencodings=ucs-bom,utf-8,cp936,gb18030,big5,euc-jp,euc-kr,latin1
  ```

以上的`fileencodings`选项的建议设置推荐放到`~/.vimrc`，避免 VIM 识别不到 GBK（CP936） 编码（这是使用 VIM 最容易遇到的编码错误的原因）。如果 VIM 确实没有识别正确，你也知道文件本身正确的编码，那么你可以使用如下命令以正确的编码重新打开本文件：
```
:e ++enc=gbk
```
详情参见`:h :e`

以`encoding`为例，简要说下 VIM 中选项的查看值、设置值的方法和获取 VIM 自带帮助的方法：

```vim
:set encoding? "查看 VIM 内部字符编码
:set encoding=utf8 "设置 VIM 内部字符编码
:help 'encoding "查看 VIM encoding 选项的相关帮助
```

另外还可使用如下命令查看文件的编码：

```bash
$ file quicker.em
quicker.em: ISO-8859 text, with CRLF line terminators
```

### 不小心按了`Ctrl+S`后卡死？

使用`Ctrl+Q`或`Ctrl+C`即可

详情参见 [keyboard - How to unfreeze after accidentally pressing Ctrl-S in a terminal? - Unix & Linux Stack Exchange](https://unix.stackexchange.com/questions/12107/how-to-unfreeze-after-accidentally-pressing-ctrl-s-in-a-terminal)

### 在 Vim 脚本中忽略'Pattern not found'错误信息
1. 使用`:silent[!]`前缀：`:h :silent`
2. 在`:s`替换命令后添加`e`选项：`:h :s_flags`

### 插入模式中从右往左书写
`:set ri`

详情参见：`:h 'ri`

### 对齐文本
* `:ri`: 右对齐
* `:ce`: 居中对齐
* `:le`: 左对齐

详情参见：`:h :ri`

### 删除二进制文件末尾的`EOF`？

```vim
:set binary noendofline
```
详情参见： [Vim show and be able to delete 0x0a at end of file - Stack Overflow](https://stackoverflow.com/questions/23358716/vim-show-and-be-able-to-delete-0x0a-at-end-of-file)

### 用过的插件

* [emmet-vim](https://github.com/mattn/emmet-vim)

[Vim]: https://www.vim.org/
[Neovim]: https://neovim.io/
